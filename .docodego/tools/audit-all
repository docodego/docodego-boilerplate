#!/usr/bin/env bash
# Regenerate all audit JSONs, build dashboard, and open it.
# Usage: .docodego/tools/audit-all

set -uo pipefail

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"
cd "$ROOT"

set -a
source "$SCRIPT_DIR/tools.env"
set +a

python -m audit_all

# Open in browser â€” derived from DOCODEGO_CYCLE
DASHBOARD="$ROOT/$DOCODEGO_CYCLE/audits/dashboard.html"
if command -v start &>/dev/null; then
    start "$DASHBOARD"
elif command -v open &>/dev/null; then
    open "$DASHBOARD"
elif command -v xdg-open &>/dev/null; then
    xdg-open "$DASHBOARD"
else
    echo "Open manually: $DASHBOARD"
fi
